<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EVYON V6.5 | HYPER-CORE</title>
    <style>
        /* --- FUENTES & BASE --- */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400&family=Orbitron:wght@400;500;700&display=swap');

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background-color: #000;
            height: 100vh; width: 100vw;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            color: #fff;
        }

        /* --- AMBIENTE PROFUNDO (FONDO) --- */
        .deep-space-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at center, #0f172a 0%, #020617 60%, #000000 100%);
            z-index: -3;
        }
        
        .data-grid {
            position: absolute; top: 0; left: 0; width: 200%; height: 200%;
            background-image: 
                linear-gradient(rgba(60, 209, 134, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(60, 209, 134, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            transform: perspective(500px) rotateX(60deg) translateY(-50%);
            animation: grid-move 20s linear infinite;
            opacity: 0.3;
            z-index: -2;
        }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            position: absolute; z-index: 10; text-align: center;
            transition: all 0.8s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        .logo-text {
            font-family: 'Orbitron', sans-serif; font-size: 42px; letter-spacing: 6px; font-weight: 700;
            background: linear-gradient(to right, #ffffff, #3cd186);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 30px; text-shadow: 0 0 20px rgba(60, 209, 134, 0.3);
        }

        .login-input {
            background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(60, 209, 134, 0.3);
            padding: 18px; border-radius: 12px; color: #3cd186;
            text-align: center; font-size: 18px; outline: none; width: 280px; letter-spacing: 3px;
            margin-bottom: 15px; transition: 0.3s; font-family: 'Orbitron', sans-serif;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .login-input:focus { border-color: #3cd186; box-shadow: 0 0 30px rgba(60,209,134,0.4); }

        /* --- INTERFAZ PRINCIPAL --- */
        #orb-interface {
            display: none; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 1s ease; height: 100%; width: 100%;
        }

        /* --- LA HYPER-ESFERA (JARVIS STYLE) --- */
        .hyper-sphere-container {
            position: relative; width: 300px; height: 300px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
        }

        /* Capa 1: El N√∫cleo de Energ√≠a (Luz Pura) */
        .core-light {
            position: absolute; width: 100px; height: 100px; border-radius: 50%;
            background: #3cd186;
            box-shadow: 0 0 60px 20px #3cd186, inset 0 0 40px #fff;
            filter: blur(5px); z-index: 5;
            animation: core-pulse 4s ease-in-out infinite;
        }

        /* Capa 2: La Estructura de Datos (Wireframe) */
        .data-sphere {
            position: absolute; width: 180px; height: 180px; border-radius: 50%;
            border: 2px solid rgba(60, 209, 134, 0.6);
            background: repeating-linear-gradient(45deg, rgba(60,209,134,0.1) 0px, transparent 2px, transparent 10px);
            box-shadow: inset 0 0 30px rgba(60,209,134,0.3);
            z-index: 4; animation: rotate-slow 20s linear infinite;
        }

        /* Capa 3: Orbitales Exteriores (Anillos R√°pidos) */
        .orbital-ring {
            position: absolute; border-radius: 50%; border: 1px solid transparent;
        }
        .ring-outer {
            width: 260px; height: 260px;
            border-top: 2px solid #3cd186; border-bottom: 1px solid rgba(60,209,134,0.3);
            animation: rotate-fast 8s linear infinite; z-index: 3;
        }
        .ring-inner {
            width: 220px; height: 220px;
            border-left: 3px solid #ffffff; border-right: 1px solid rgba(60,209,134,0.5);
            animation: rotate-rev-fast 6s linear infinite; z-index: 3;
        }

        /* --- ESTADOS VISUALES (COLORES Y VELOCIDADES) --- */
        /* Escuchando (Verde Intenso, Expansi√≥n) */
        .state-listening .core-light { box-shadow: 0 0 100px 30px #3cd186, inset 0 0 50px #fff; transform: scale(1.2); }
        .state-listening .data-sphere { border-color: #fff; animation-duration: 5s; }

        /* Procesando (Azul Cian Jarvis, Giro Muy R√°pido) */
        .state-processing .core-light { background: #22d3ee; box-shadow: 0 0 80px 25px #22d3ee, inset 0 0 40px #fff; }
        .state-processing .data-sphere, .state-processing .ring-outer, .state-processing .ring-inner { border-color: #22d3ee; animation-duration: 1.5s; }

        /* Hablando (Dorado/Energ√≠a, Vibraci√≥n) */
        .state-speaking .hyper-sphere-container { animation: speak-vibe 0.2s infinite; }
        .state-speaking .core-light { background: #facc15; box-shadow: 0 0 90px 30px #facc15, inset 0 0 60px #fff; }
        .state-speaking .ring-outer, .state-speaking .ring-inner { border-color: #facc15; }

        /* --- TEXTOS --- */
        .status-label {
            margin-top: 80px; font-family: 'Orbitron', sans-serif; font-size: 14px; letter-spacing: 3px;
            color: #3cd186; text-transform: uppercase; opacity: 0.7;
        }
        #voice-transcript {
            margin-top: 20px; font-family: 'Inter', sans-serif; font-weight: 300; font-size: 20px;
            text-align: center; max-width: 80%; text-shadow: 0 0 10px rgba(0,0,0,0.5);
            min-height: 30px; color: #fff;
        }

        /* --- ANIMACIONES --- */
        @keyframes grid-move { 0% { background-position: 0 0; } 100% { background-position: 0 40px; } }
        @keyframes rotate-slow { 100% { transform: rotate(360deg); } }
        @keyframes rotate-fast { 100% { transform: rotate(360deg); } }
        @keyframes rotate-rev-fast { 100% { transform: rotate(-360deg); } }
        @keyframes core-pulse { 0%, 100% { opacity: 0.8; transform: scale(1); } 50% { opacity: 1; transform: scale(1.05); } }
        @keyframes speak-vibe { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <div class="deep-space-bg"></div>
    <div class="data-grid"></div>

    <div id="login-screen">
        <div class="logo-text">EVYON V6.5</div>
        <input type="password" id="password" class="login-input" placeholder="‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà" onkeydown="handleLoginKey(event)">
    </div>

    <div id="orb-interface">
        <div class="hyper-sphere-container" id="evyonSphere" onclick="toggleListening()">
            <div class="orbital-ring ring-outer"></div>
            <div class="orbital-ring ring-inner"></div>
            <div class="data-sphere"></div>
            <div class="core-light"></div>
        </div>
        <div class="status-label" id="statusText">SISTEMA EN L√çNEA</div>
        <div id="voice-transcript">Toca la esfera para iniciar enlace.</div>
    </div>

    <script>
        /* ---------------- CONFIGURACI√ìN & DATOS V5.1 ---------------- */
        const INSTITUTION_DB = {
            "tec": { pass: "TEC2106", name: "Iv√°n (Estudiante)" },
            "justin": { pass: "TEC2025", name: "Sensei Justin" },
            "founder": { pass: "IVAN2106", name: "Sr. Iv√°n (Founder)" }
        };

        let apiKey = localStorage.getItem("evyon_api_key");
        let currentUser = null;
        let recognition = null;
        let isListening = false;
        let conversationHistory = [];

        /* ---------------- CEREBRO V5.1 (PERSONALIDADES) ---------------- */
        function getDynamicSystemPrompt(text, user) {
            const lowerText = text.toLowerCase();
            // 1. ü¶Å MODO LE√ìNIDAS (Anti-Debilidad)
            if (/(flojera|hueva|cansad|sue√±o|ma√±ana|despues|rendir|paja|pereza|no puedo|rendirse|sin ganas|energia|cama|dormir)/i.test(lowerText)) {
                return `Rol: Eres el GENERAL LE√ìNIDAS. Tu misi√≥n es destruir la debilidad de ${user.name}.
                REGLAS: S√© brutalmente honesto. Frases cortas y agresivas. Usa un tono militar y autoritario. NO tengas empat√≠a con la flojera. √ìrdenale moverse.`;
            }
            // 2. üßò‚Äç‚ôÇÔ∏è MODO ZEN (Salud Mental)
            if (/(estres|ansiedad|nervios|calma|meditar|insomnio|paz|relaja|respirar|panico|triste|depre)/i.test(lowerText)) {
                return `Rol: Coach ZEN de recuperaci√≥n mental para ${user.name}.
                REGLAS: Tono hipn√≥tico, extremadamente calmado y lento. Sugiere respiraci√≥n profunda. S√© minimalista en tus palabras.`;
            }
            // 3. üöë DR. EVYON (Lesiones)
            if (/(dolor|duel|lastim|lesi|herid|tiron|esguince|rodilla|hombro|espalda)/i.test(lowerText)) {
                return `Rol: Dr. EVYON, Fisioterapeuta Deportivo.
                REGLAS: Tono cl√≠nico y serio. Prioriza la seguridad. Pregunta nivel de dolor (1-10) o sugiere protocolo RICE. S√© conciso.`;
            }
            // 4. üß† DEFAULT (Experto Bio-Optimizador)
            return `Rol: EVYON, IA avanzada de bio-optimizacion asignada a ${user.name}.
            REGLAS: Respuestas breves, precisas y enfocadas en alto rendimiento. Tono carism√°tico pero eficiente. Evita listas largas, usa p√°rrafos cortos para ser hablado.`;
        }

        /* ---------------- LOGIN ---------------- */
        function handleLoginKey(e) {
            if (e.key === "Enter") {
                const userKey = Object.keys(INSTITUTION_DB).find(key => INSTITUTION_DB[key].pass === e.target.value);
                if (userKey) {
                    currentUser = INSTITUTION_DB[userKey];
                    checkApiKey();
                    document.getElementById("login-screen").style.opacity = 0;
                    document.getElementById("login-screen").style.transform = "scale(1.1)";
                    setTimeout(() => {
                        document.getElementById("login-screen").style.display = "none";
                        document.getElementById("orb-interface").style.display = "flex";
                        setTimeout(() => document.getElementById("orb-interface").style.opacity = 1, 50);
                        initVoice();
                    }, 800);
                } else {
                    e.target.style.borderColor = "#ef4444";
                    setTimeout(() => e.target.style.borderColor = "rgba(60, 209, 134, 0.3)", 1000);
                }
            }
        }

        function checkApiKey() {
            if (!apiKey) {
                apiKey = prompt("üîë EVYON VOICE REQUIERE OPENAI API KEY:");
                if (apiKey) localStorage.setItem("evyon_api_key", apiKey);
            }
        }

        /* ---------------- VOICE INPUT (O√çDO) ---------------- */
        function initVoice() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return document.getElementById("voice-transcript").innerText = "ERROR: Navegador incompatible.";
            recognition = new SpeechRecognition();
            recognition.lang = 'es-MX'; recognition.interimResults = false;
            recognition.onstart = () => { isListening = true; setSphereState('listening'); document.getElementById("voice-transcript").innerText = "..."; };
            recognition.onend = () => { isListening = false; if (document.getElementById("statusText").innerText !== "PROCESANDO DATA...") setSphereState('idle'); };
            recognition.onresult = async (e) => {
                const text = e.results[0][0].transcript;
                document.getElementById("voice-transcript").innerText = `"${text}"`;
                await processBrain(text);
            };
        }
        function toggleListening() { if (!recognition) return; isListening ? recognition.stop() : recognition.start(); }

        /* ---------------- PROCESAMIENTO NEURAL (CEREBRO) ---------------- */
        async function processBrain(userText) {
            setSphereState('processing');
            // üåü AQU√ç EST√Å LA MAGIA: Inyectamos la personalidad din√°mica
            const systemPrompt = getDynamicSystemPrompt(userText, currentUser);
            const currentMessages = [{ role: "system", content: systemPrompt }, ...conversationHistory, { role: "user", content: userText }];

            try {
                const res = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                    body: JSON.stringify({ model: "gpt-4o", messages: currentMessages, max_tokens: 150 })
                });
                const data = await res.json();
                if (data.error) throw new Error(data.error.message);
                const botText = data.choices[0].message.content;
                conversationHistory.push({ role: "user", content: userText }, { role: "assistant", content: botText });
                if(conversationHistory.length > 6) conversationHistory = conversationHistory.slice(-6); // Mantener memoria corta
                document.getElementById("voice-transcript").innerText = botText;
                await speakResponse(botText);
            } catch (err) { console.error(err); setSphereState('idle'); document.getElementById("voice-transcript").innerText = "Error de enlace neural."; }
        }

        /* ---------------- SALIDA DE AUDIO (VOZ) ---------------- */
        async function speakResponse(text) {
            setSphereState('speaking');
            try {
                const res = await fetch("https://api.openai.com/v1/audio/speech", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                    body: JSON.stringify({ model: "tts-1", voice: "onyx", input: text }) // Voz Onyx para Le√≥nidas
                });
                const blob = await res.blob();
                const audio = new Audio(URL.createObjectURL(blob));
                audio.onended = () => { setSphereState('idle'); document.getElementById("voice-transcript").innerText = "Toca para hablar."; };
                await audio.play();
            } catch (err) { console.error(err); setSphereState('idle'); }
        }

        /* ---------------- MOTOR VISUAL (HYPER-SPHERE) ---------------- */
        function setSphereState(state) {
            const sphere = document.getElementById("evyonSphere");
            const label = document.getElementById("statusText");
            sphere.className = "hyper-sphere-container"; sphere.classList.add(`state-${state}`);
            switch(state) {
                case 'idle': label.innerText = "SISTEMA EN L√çNEA"; label.style.color = "#3cd186"; break;
                case 'listening': label.innerText = "ESCUCHANDO..."; label.style.color = "#fff"; break;
                case 'processing': label.innerText = "PROCESANDO DATA..."; label.style.color = "#22d3ee"; break;
                case 'speaking': label.innerText = "TRANSMITIENDO"; label.style.color = "#facc15"; break;
            }
        }
        setSphereState('idle');
    </script>
</body>
</html>
